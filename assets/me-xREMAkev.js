import{w as k,a as n,o as t,t as g}from"./chunk-NL6KNZEE-D71spLCj.js";import{u as q}from"./AuthContext-CpWodBBB.js";import{a as d,F as l,b as A,c as $,d as C,e as w}from"./index-C6LqSLaZ.js";const S=[{key:"friends",label:"Друзья"},{key:"requests",label:"Запросы в друзья"},{key:"add",label:"Добавить в друзья"}],D=k(function(){const[c,v]=n.useState("friends"),{accessToken:a,user:i}=q(),[u,x]=n.useState([]),[o,m]=n.useState([]),[j,f]=n.useState(null),[h,N]=n.useState({});n.useEffect(()=>{a&&d.get("http://127.0.0.1:8000/auth/friends",{headers:{Authorization:`Bearer ${a}`}}).then(e=>{const s=e.data.filter(r=>r.status==="accepted");x(s)}).catch(()=>x([]))},[a]),n.useEffect(()=>{a&&d.get("http://127.0.0.1:8000/auth/friends/requests",{headers:{Authorization:`Bearer ${a}`}}).then(e=>m(e.data)).catch(()=>m([]))},[a]);const p=async e=>{if(!h[e])try{const s=await d.get(`http://127.0.0.1:8000/auth/user/${e}/username`);N(r=>({...r,[e]:s.data.username}))}catch{}};n.useEffect(()=>{u.forEach(e=>{const s=i&&e.requester_id===i.id?e.addressee_id:e.requester_id;p(s)}),o.forEach(e=>{const s=e.requester_id,r=e.addressee_id;p(s),p(r)})},[u,o,i]);const y=async e=>{if(window.confirm("Вы уверены, что хотите удалить этого друга?")&&a)try{await d.delete(`http://127.0.0.1:8000/auth/friends/${e}`,{headers:{Authorization:`Bearer ${a}`}}),x(s=>s.filter(r=>r.id!==e))}catch{alert("Ошибка при удалении друга")}},_=async e=>{if(a)try{await d.post(`http://127.0.0.1:8000/auth/friends/respond/${e}`,!0,{headers:{Authorization:`Bearer ${a}`}}),m(s=>s.filter(r=>r.id!==e))}catch{alert("Ошибка при принятии заявки")}};return t.jsxs("div",{className:"flex flex-col h-full gap-[8px]",children:[t.jsx("div",{className:"bg-white/10 flex flex-row items-center p-[8px] gap-[8px] rounded-[8px]",children:S.map(e=>t.jsx("button",{className:"p-[8px] rounded-[8px] cursor-pointer transition "+(c===e.key?"bg-white/10":"hover:bg-white/10"),onClick:()=>v(e.key),children:e.label},e.key))}),t.jsxs("div",{className:"flex-1 bg-white/10 p-[8px] rounded-[8px]",children:[c==="friends"&&t.jsx("div",{children:t.jsx("ul",{className:"flex flex-col gap-2",children:u.map(e=>{const s=i&&e.requester_id===i.id?e.addressee_id:e.requester_id;return t.jsxs("li",{className:"flex items-center gap-2 justify-between relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 flex-shrink-0",children:t.jsx("img",{className:"w-10 h-10 rounded-full object-cover",src:"http://127.0.0.1:8000/auth/avatars/"+s,alt:h[s]||s})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"font-semibold",children:h[s]||s})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(g,{to:`/me/${s}`,className:"w-[42px] h-[42px] flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-[8px] text-white/50 transition cursor-pointer",children:t.jsx(l,{icon:A})}),t.jsx("button",{className:"w-[42px] h-[42px] flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-[8px] text-white/50 transition cursor-pointer",onClick:()=>f(j===e.id?null:e.id),children:t.jsx(l,{icon:$})}),j===e.id&&t.jsxs("div",{className:"absolute right-0 top-12 z-10 bg-white/10 border border-white/10 rounded shadow-lg flex flex-col min-w-[120px]",children:[t.jsx(g,{to:`/me/${s}`,className:"px-4 py-2 text-left hover:bg-white/10 transition text-white",onClick:()=>f(null),children:"Чат"}),t.jsx("button",{className:"px-4 py-2 text-left hover:bg-red-500/20 transition text-red-400",onClick:()=>{y(s),f(null)},children:"Удалить"})]})]})]},e.id)})})}),c==="requests"&&t.jsx("div",{children:t.jsxs("ul",{className:"flex flex-col gap-2",children:[o.length===0&&t.jsx("li",{className:"text-white/50",children:"Нет заявок"}),o.filter(e=>i&&(e.addressee_id===i.id||e.requester_id===i.id)).map(e=>{const s=i&&e.addressee_id===i.id,r=i&&e.requester_id===i.id;return t.jsxs("li",{className:"flex items-center gap-2 justify-between relative bg-white/5 rounded p-2",children:[t.jsx("span",{className:"font-semibold",children:h[s?e.requester_id:e.addressee_id]||(s?e.requester_id:e.addressee_id)}),t.jsxs("div",{className:"flex gap-2",children:[s&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-green-500/30 hover:bg-green-500/60 rounded-full text-green-300 hover:text-green-100 transition",title:"Принять",onClick:()=>_(e.id),children:t.jsx(l,{icon:C})}),t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-red-500/30 hover:bg-red-500/60 rounded-full text-red-300 hover:text-red-100 transition",title:"Отклонить",children:t.jsx(l,{icon:w})})]}),r&&t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-red-500/30 hover:bg-red-500/60 rounded-full text-red-300 hover:text-red-100 transition",title:"Отменить (не реализовано)",disabled:!0,children:t.jsx(l,{icon:w})})]})]},e.id)})]})}),c==="add"&&t.jsx("div",{className:"flex flex-col gap-4 max-w-xs mx-auto mt-8",children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault();const r=e.currentTarget.elements.namedItem("addressee_id"),b=r.value.trim();if(b)try{await d.post("http://127.0.0.1:8000/auth/friends/request",{addressee_id:b},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),r.value="",alert("Заявка отправлена!")}catch{alert("Ошибка при отправке заявки в друзья")}},children:[t.jsx("label",{className:"block mb-2 text-white/70",htmlFor:"addressee_id",children:"ID пользователя для добавления в друзья"}),t.jsx("input",{type:"text",name:"addressee_id",id:"addressee_id",className:"w-full p-2 rounded bg-white/10 text-white mb-2",placeholder:"Введите UUID пользователя"}),t.jsx("button",{type:"submit",className:"w-full bg-sky-600 hover:bg-sky-700 text-white rounded p-2 transition",children:"Добавить в друзья"})]})})]})]})});export{D as default};
