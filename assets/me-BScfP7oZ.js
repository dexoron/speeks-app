import{w as q,a as n,o as t,t as w}from"./chunk-NL6KNZEE-D71spLCj.js";import{u as $,a as d}from"./AuthContext-z9X0gYbi.js";import{a as l,F as c,b as A,c as S,d as C,e as v}from"./index-C6LqSLaZ.js";const E=[{key:"friends",label:"Друзья"},{key:"requests",label:"Запросы в друзья"},{key:"add",label:"Добавить в друзья"}],D=q(function(){const[o,N]=n.useState("friends"),{accessToken:a,user:i}=$(),[x,m]=n.useState([]),[u,f]=n.useState([]),[b,p]=n.useState(null),[h,y]=n.useState({});n.useEffect(()=>{a&&l.get(`${d}/auth/friends`,{headers:{Authorization:`Bearer ${a}`}}).then(e=>{const s=e.data.filter(r=>r.status==="accepted");m(s)}).catch(()=>m([]))},[a]),n.useEffect(()=>{a&&l.get(`${d}/auth/friends/requests`,{headers:{Authorization:`Bearer ${a}`}}).then(e=>f(e.data)).catch(()=>f([]))},[a]);const j=async e=>{if(!h[e])try{const s=await l.get(`${d}/auth/user/${e}/username`);y(r=>({...r,[e]:s.data.username}))}catch{}};n.useEffect(()=>{x.forEach(e=>{const s=i&&e.requester_id===i.id?e.addressee_id:e.requester_id;j(s)}),u.forEach(e=>{const s=e.requester_id,r=e.addressee_id;j(s),j(r)})},[x,u,i]);const _=async e=>{if(window.confirm("Вы уверены, что хотите удалить этого друга?")&&a)try{await l.delete(`${d}/auth/friends/${e}`,{headers:{Authorization:`Bearer ${a}`}}),m(s=>s.filter(r=>r.id!==e))}catch{alert("Ошибка при удалении друга")}},k=async e=>{if(a)try{await l.post(`${d}/auth/friends/respond/${e}`,!0,{headers:{Authorization:`Bearer ${a}`}}),f(s=>s.filter(r=>r.id!==e))}catch{alert("Ошибка при принятии заявки")}};return t.jsxs("div",{className:"flex flex-col h-full gap-[8px]",children:[t.jsx("div",{className:"bg-white/10 flex flex-row items-center p-[8px] gap-[8px] rounded-[8px]",children:E.map(e=>t.jsx("button",{className:"p-[8px] rounded-[8px] cursor-pointer transition "+(o===e.key?"bg-white/10":"hover:bg-white/10"),onClick:()=>N(e.key),children:e.label},e.key))}),t.jsxs("div",{className:"flex-1 bg-white/10 p-[8px] rounded-[8px]",children:[o==="friends"&&t.jsx("div",{children:t.jsx("ul",{className:"flex flex-col gap-2",children:x.map(e=>{const s=i&&e.requester_id===i.id?e.addressee_id:e.requester_id;return t.jsxs("li",{className:"flex items-center gap-2 justify-between relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 flex-shrink-0",children:t.jsx("img",{className:"w-10 h-10 rounded-full object-cover",src:`${d}/auth/avatars/`+s,alt:h[s]||s})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"font-semibold",children:h[s]||s})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(w,{to:`/me/${s}`,className:"w-[42px] h-[42px] flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-[8px] text-white/50 transition cursor-pointer",children:t.jsx(c,{icon:A})}),t.jsx("button",{className:"w-[42px] h-[42px] flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-[8px] text-white/50 transition cursor-pointer",onClick:()=>p(b===e.id?null:e.id),children:t.jsx(c,{icon:S})}),b===e.id&&t.jsxs("div",{className:"absolute right-0 top-12 z-10 bg-white/10 border border-white/10 rounded shadow-lg flex flex-col min-w-[120px]",children:[t.jsx(w,{to:`/me/${s}`,className:"px-4 py-2 text-left hover:bg-white/10 transition text-white",onClick:()=>p(null),children:"Чат"}),t.jsx("button",{className:"px-4 py-2 text-left hover:bg-red-500/20 transition text-red-400",onClick:()=>{_(s),p(null)},children:"Удалить"})]})]})]},e.id)})})}),o==="requests"&&t.jsx("div",{children:t.jsxs("ul",{className:"flex flex-col gap-2",children:[u.length===0&&t.jsx("li",{className:"text-white/50",children:"Нет заявок"}),u.filter(e=>i&&(e.addressee_id===i.id||e.requester_id===i.id)).map(e=>{const s=i&&e.addressee_id===i.id,r=i&&e.requester_id===i.id;return t.jsxs("li",{className:"flex items-center gap-2 justify-between relative bg-white/5 rounded p-2",children:[t.jsx("span",{className:"font-semibold",children:h[s?e.requester_id:e.addressee_id]||(s?e.requester_id:e.addressee_id)}),t.jsxs("div",{className:"flex gap-2",children:[s&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-green-500/30 hover:bg-green-500/60 rounded-full text-green-300 hover:text-green-100 transition",title:"Принять",onClick:()=>k(e.id),children:t.jsx(c,{icon:C})}),t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-red-500/30 hover:bg-red-500/60 rounded-full text-red-300 hover:text-red-100 transition",title:"Отклонить",children:t.jsx(c,{icon:v})})]}),r&&t.jsx("button",{className:"w-8 h-8 flex items-center justify-center bg-red-500/30 hover:bg-red-500/60 rounded-full text-red-300 hover:text-red-100 transition",title:"Отменить (не реализовано)",disabled:!0,children:t.jsx(c,{icon:v})})]})]},e.id)})]})}),o==="add"&&t.jsx("div",{className:"flex flex-col gap-4 max-w-xs mx-auto mt-8",children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault();const r=e.currentTarget.elements.namedItem("addressee_id"),g=r.value.trim();if(g)try{await l.post(`${d}/auth/friends/request`,{addressee_id:g},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),r.value="",alert("Заявка отправлена!")}catch{alert("Ошибка при отправке заявки в друзья")}},children:[t.jsx("label",{className:"block mb-2 text-white/70",htmlFor:"addressee_id",children:"ID пользователя для добавления в друзья"}),t.jsx("input",{type:"text",name:"addressee_id",id:"addressee_id",className:"w-full p-2 rounded bg-white/10 text-white mb-2",placeholder:"Введите UUID пользователя"}),t.jsx("button",{type:"submit",className:"w-full bg-sky-600 hover:bg-sky-700 text-white rounded p-2 transition",children:"Добавить в друзья"})]})})]})]})});export{D as default};
