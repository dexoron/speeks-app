import{a as f,o as k}from"./chunk-NL6KNZEE-D71spLCj.js";/*! js-cookie v3.0.5 | MIT */function g(n){for(var c=1;c<arguments.length;c++){var r=arguments[c];for(var l in r)n[l]=r[l]}return n}var A={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function m(n,c){function r(t,i,e){if(!(typeof document>"u")){e=g({},c,e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires&&(e.expires=e.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var o in e)e[o]&&(s+="; "+o,e[o]!==!0&&(s+="="+e[o].split(";")[0]));return document.cookie=t+"="+n.write(i,t)+s}}function l(t){if(!(typeof document>"u"||arguments.length&&!t)){for(var i=document.cookie?document.cookie.split("; "):[],e={},s=0;s<i.length;s++){var o=i[s].split("="),v=o.slice(1).join("=");try{var u=decodeURIComponent(o[0]);if(e[u]=n.read(v,u),t===u)break}catch{}}return t?e[t]:e}}return Object.create({set:r,get:l,remove:function(t,i){r(t,"",g({},i,{expires:-1}))},withAttributes:function(t){return m(this.converter,g({},this.attributes,t))},withConverter:function(t){return m(g({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(c)},converter:{value:Object.freeze(n)}})}var d=m(A,{path:"/"});const C=f.createContext(void 0);function w({children:n}){const[c,r]=f.useState(null),[l,t]=f.useState(null),[i,e]=f.useState(null),[s,o]=f.useState(!0);f.useEffect(()=>{const a=d.get("access_token"),h=d.get("refresh_token");a&&h?(t(a),e(h),fetch("http://127.0.0.1:8000/auth/me",{headers:{Authorization:`Bearer ${a}`}}).then(async p=>{if(p.ok){const x=await p.json();r(x),localStorage.setItem("user",JSON.stringify(x))}else u()}).catch(()=>u()).finally(()=>o(!1))):o(!1)},[]);const v=(a,h,p)=>{t(a),e(h),r(p),d.set("access_token",a,{sameSite:"strict"}),d.set("refresh_token",h,{sameSite:"strict"}),localStorage.setItem("user",JSON.stringify(p))},u=()=>{t(null),e(null),r(null),d.remove("access_token"),d.remove("refresh_token"),localStorage.removeItem("user")};return k.jsx(C.Provider,{value:{user:c,accessToken:l,refreshToken:i,loading:s,login:v,logout:u},children:n})}function I(){const n=f.useContext(C);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}export{w as A,I as u};
